22.08.03----시작
간단한 오징어게임, fall guys 게임 만들기.
다양한 캐릭터 존재. 캐릭터간 능력, 특수스킬 존재.

시작장소.(스폰장소)
Goal 장소

게임 시작시 master client에서 현재 룸에 있는 플레이어 들에게 각 플레이어 번호 부여
(각 게임의 스크립트에 photonview를 달고 rpc로 

1.유리다리 게임 (Glass Bridge)
발판이 두줄로 생성. 둘중 하나는 떨어지는 발판, 하나는 안전한 발판.

유리 발판 오브젝트: 부서질 상태 bool타입 변수 hard

유리생성 알고리즘:
- 2x10배열의 유리 오브젝트 생성
-생성시 각 행마다 랜덤으로 하나는 hard true 하나는 hard false 설정
-false 유리는 collider가 없음

goal지점 착지시  클리어


해야할것:
방이름 중복확인.
방데이터도 데이터베이스넣기? 포톤에서관리?


----8.6--------

photon 네트워크 이용중.
게임 입장시 두번째 플레이어 부터는 플레이어가 2번 인스턴스되는 오류 미해결 (해결)
유리발판의 hard 동기화 해야함. 
=> 1. 마스터 클라이언트로 생성후 hard를 1번 랜덤하게 설정해줌. 그 후 (OnPhotonSerializeView나 RPC)로 데이터 전송, 받기로 다른 플레이어들의 유리발판의hard상태도 똑같이 변경.

=>2. hard 상태를 true와 false 로 나눈 프리팹 두개를 만들어 각각 같은 행에서 열의 위치만 랜덤하게 photonnetwork.instantiate 해줌



오른쪽 위에 1등부터 등수 표시 (통과한 순서)
등수 데이터는 마스터 클라이언트가 가지고 있고. 나머지 클라이언트들에게 전송.
UI에서 랭킹 표시 따로, 랭킹 스크립트 따로. 랭킹 스크립트는 네트워크 통신으로 마스터 클라이언트일경우 함수 호출

골존의 viewID는 마스터 클라이언트의 ID(생성을 마스터 클라이언트에서 함)이다. 플레이어 골인시 glassBridgeGame 에 GoalIn함수를 호출(인자로 플레이어 넘버).
게임 스크립트에있는 랭킹 배열을 갱신. (마스터 클라이언트만.)
 해당 게임에서 각 glassbridgeGame에 rpc 호출.(랭킹 배열 인자)

----8.12----
photon 팁) photonview를 달고 master클라이언트에서만 network.instantiate 해주면 해당 view ID는 마스터클라이언트 viewID만 가진다.
photonview를 단 hierachy 상으로만 놓여진 오브젝트는 (보통 빈 오브젝트나 기본 오브젝트) local상으로 놓여진 오브젝트이므로 viewID, owner등이 수동 설정이라 보통 마스터(1)로 설정함. 
싱글톤 팁) static은 메모리 영억중 heap영억에 존재 프로그램 시작시 메모리가 할당됨으로 언제든 바로 할당가능
씬 전환시 컴포넌트로 할당된 기본 오브젝트는 씬변경시 missing이 떠도 씬이 돌아오면 자동으로 다시 할당되 있지만, 스크립트가 있는 컴포넌트는 씬이 돌아오면 (monobehaviour)에 의해 새롭게 instance 되므로 할당이 풀림 missing됨
=> 1. 싱글톤에
 else if(instance!=this){
            Destroy(instance.gameObject);
            instance=this;
            DontDestroyOnLoad(this.gameObject);
        }
를 달아주거나.
2. 다른 씬에서 사용 안할거면 dont destroy on load를 쓸 필요가 없다.

dont destoryonload를 없에고


---8.13----
로비 개선. => 커스텀 방 만들기 , 자동 매칭 버튼

커스텀방: 
구성-상단에 방 코드, 참가 플레이어 목록 게임선택(추후)

자동매칭: 특정 인원수 넘으면 최소 대기시간후 시작 or 최대 대기시간 후 시작

각 버튼 누르면
커스텀방 만들기는 자동 커스텀 룸 생성후 초대코드 생성.(서버상에서 joinlobby)
방 UI: 참가 플레이어 닉네임, 초대코드.
커스텀방 입장은 초대코드 입력 란 UI

커스텀 방과 랜덤 매칭은 서로 다른 로비에서 접속. (랜덤으로 커스텀 방이 매칭되면 안됨)

랜덤 매칭은 서버상에서 joinlobby,  매칭 안내 메세지 + "매칭된 인원/ 최대인원" 알려줌. 대기시간 지나면 최대인원 안차도 5초후 시작 메세지 후 룸 입장

8.15=====

커스텀 방 틀 구성 완료. (생성버튼 입장버튼 및 기본 UI 와 이에따른 서버 통신)

해야할것:
플레이어 목록 prefab화 해서 정보 담기.
custom 방에서 플레이어 목록 입장,퇴장시 동기화.

커스텀방 입장 손봐야함 (방없어도 UI뜸)-해결

로비 없에기. (joinroom은 로비와 관계없이 이름만 매치되면 접속.) 룸 리스트 목록을 보여줄 거 아니면 필요없다.- 완료

8.17------
커스텀 방에서 플레이어 입장, 퇴장시 플레이어 목록 갱신

플레이어 정보는 번호, 닉네임
custom room 스크립트에서 입장,퇴장시 puncallback을 이용
 grid layout을 이용하지 않고해봄.=> 일반배치보다 성능을 먹는다고 해서. (ui몇개없어서 상관없지만 그냥 해봄)

입장시 actornumber, nickname 받아온후
playerinfoPrefab을 instantate

먼저 방 입장시 자신의 프리팹을 생성후 첫번째에 배치. 그후 입장해 있던 인원들 들어온 순서대로(photonnetwork.playerlist 순서) 배치. but 자신 중복 주의

ui배치 위치는 스크립트상 playerlist의 index가 짝수인지 홀수인지에 따른 배치

나가면? 나가면 플레이어 리스트들을 싹 갱신해서 다시 오브젝트들을 만들어 배치해도 되지만.
너무 비효율적.


--------
OnPlayerEnteredRoom이 customroom 스크립트에선 동작안하고 networkmanager에서만 동작함
=>customroom 스크립트에 override OnEnable 을 구현해서 그럼. (정확한 이유모름.)
new void OnEnable() 만 구현해도 동작안함 (monobehaviour 기존 콜백함수)
Onenable 관련 함수를 없에거나.
Onenable에 PhotonNetwork.AddCallbackTarget(this); 를 추가해 주면 동작함


-----8.18

대기 룸에서 플레이어 정보 카드?들을 들어오고 나갈때마다 생성, 위치 변경이 아닌 미리 maxplayer수 만큼 생성후 비활성화. 들어올때마다 활성화후 정보만 바꿔주자. 왜 이생각을 못했지?
오브젝트 풀링이지만 자주 생성,삭제되는게 아니라 메모리 적으론 크게 상관없으나. 위치설정 관련 오류들 해결 및 불필요한 오브젝트 이동 및 이동을 통한 캔버스 드로우콜 감소, 코드 간소화

스타트버튼 방장한테만 보이게 생성

glassBridge게임 전체적인 틀 구성 완료.

9.9-----
플레이어 이동 방식 및 카메라 회전 변경 = > 카메라가 바라보는 방향으로이동
 이동속도가 위방향키,좌우방향키 동시에 누르면 그만큼빨라짐. 평균을 내야한다

9.13====
파이어베이스 sdk중 구글 애널리스틱을 넣지 않아 빌드한 apk를 녹스에서 실행했을때 파이어베이스 연결이 안됐다. 넣으니 됨.
이제 구글 플레이 연동을 해야한다.
에디터에선 구글 플레이 함수 동작? 은 한다. 물론 당연히 연결은 안댐. 그러나 apk에선 위 파이어베이스 연결처럼 여전히 동작을 안함 무반응.

9.14---------
구글플레이 로그인 연동완료 (3일동안 개고생 같은짓반복)
검색해서 나오는 코드, 방법 등은 google play games plugin 11.01버전 (github에있는 최신버전)이 아니라 10.14버전(or그 이하버전들) 기준이다. 10.14쓰는게 편함
에디터버전파일 경로에 한글이 있어서 64비트 빌드할때 오류났었음
개발자계정에 playgames서비스 설정- 사용자 인증정보에 게임서버도 넣어야함(이걸 파이어베이스에서 인증서지문을 입력하면 자동으로 연동된 google cloud platform에서 생성된 web클라이언트 id를 사용자인증정보의 게임서버에 연동했는데! 이렇게 해서 안된거였음.
그냥 구글클라우드플랫폼에서 따로 웹클라이언트로 oauth2.0 클라이언트 id를 만들고 이름말고는 아무것도 입력안한후 ->> 플레이게임즈서비스에서 게임서버 추가후 이걸로 연동. 하니까 연동됨.
이때 연동된 정보를 파이어베이스 유저정보에 넘겨주는 방식(코드로) 으로 하니 파이어베이스에도 올라감!